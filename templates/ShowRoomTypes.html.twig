<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ hotel.Hotel_Name }} - Room Types</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">

{% include 'header.html.twig' with {'user': user} %}
{% set nav_links = [{'href': 'index.php', 'text': 'Home'}] %}
{% include 'navigationmenu.html.twig' with {'nav_links': nav_links, 'user': user} %}

<div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold mb-2">{{ hotel.Hotel_Name }}</h1>
    <p class="text-gray-600 mb-6">{{ hotel.Hotel_City_Name }}, {{ hotel.Hotel_Country_Name }}</p>
    <!-- weather forecast API -->
    <h2 class="text-2xl font-semibold mb-3">Today Weather</h2>
    {% include 'weatherforecast.html.twig' with { hotel: hotel } %}
    <!-- MAP API -->
    {% if hotel.Latitude and hotel.Longitude %}
        <h2 class="text-2xl font-semibold mb-3">Hotel Location</h2>
        <div id="hotel-map" class="w-full h-64 rounded-lg shadow-lg mb-6"></div>
        <script>
            window.HOTEL_DATA = {
                lat: {{ hotel.Latitude }},
                lon: {{ hotel.Longitude }},
                name: "{{ hotel.Hotel_Name|e('js') }}"
            };
        </script>
        <script src="javascripts/mapApi.js"></script>
    {% endif %}

    <!-- Room cards with carousel -->
    <h2 class="text-2xl font-semibold mb-4">Available Room Types</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

        {% for type in ['Standard', 'Deluxe', 'Suite'] %}
            {% set room = roomTypes|filter(r => r.Room_Type == type)|first %}
            {% set first_room = room.available_rooms[0] ?? null %}
            {% if first_room %}
                {% set images = [room.Image1, room.Image2, room.Image3]|filter(v => v) %}
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <h3 class="text-xl font-bold p-4">{{ type }} Room</h3>
                    {% if images %}
                        <div class="relative w-full overflow-hidden">
                            <div id="carousel-{{ type|lower }}" class="flex transition-transform duration-500">
                                {% for img in images %}
                                    <img src="{{ img }}" class="w-full h-48 object-cover flex-shrink-0" alt="{{ type }} Image">
                                {% endfor %}
                            </div>
                        </div>
                    {% else %}
                        <div class="h-48 w-full flex items-center justify-center bg-gray-200 text-gray-500">
                            No images available
                        </div>
                    {% endif %}
                    <div class="p-4">
                        <p><strong>Bed Type:</strong> {{ room.Bed_Type }}</p>
                        <p><strong>Size:</strong> {{ room.Room_Square_Meter }} m²</p>
                        <p><strong>Price per night:</strong> €{{ room.Price }}</p>
                        <p><strong>Room Number:</strong> {{ first_room.Room_Number }}</p>
                        
                        {% set city_val = city|default('') %}
                        {% set star_val = star_rating|default('') %}

                        {% if user %}
                            <form method="POST" action="booking.php">
                                <input type="hidden" name="hotel_id" value="{{ hotel.Hotel_Id }}">
                                <input type="hidden" name="room_id" value="{{ first_room.Room_Id }}">
                                <input type="hidden" name="check_in" value="{{ check_in }}">
                                <input type="hidden" name="check_out" value="{{ check_out }}">
                                <input type="hidden" name="country" value="{{ country }}">
                                <input type="hidden" name="city" value="{{ city_val }}">
                                <input type="hidden" name="star_rating" value="{{ star_val }}">
                                <button type="submit" class="w-full md:w-auto px-4 py-2 rounded bg-[#D4AF37] text-black font-semibold hover:bg-[#B9972B] mt-2">
                                    Book {{ type }} Room
                                </button>
                            </form>
                        {% else %}
                            <a href="login.php?hotel_id={{ hotel.Hotel_Id }}&room_id={{ first_room.Room_Id }}&check_in={{ check_in }}&check_out={{ check_out }}&country={{ country }}&city={{ city_val }}&star_rating={{ star_val }}"
                               class="w-full md:w-auto inline-block text-center px-4 py-2 rounded bg-[#D4AF37] text-black font-semibold hover:bg-[#B9972B] mt-2">
                                Login to Book
                            </a>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}

    </div>
</div>

<script src="javascripts/carouselplay.js"></script>
{% include 'footer.html.twig' %}

</body>
</html>
