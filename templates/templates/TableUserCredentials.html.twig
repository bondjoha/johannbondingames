<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Credentials Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto py-8">

        <!-- Header -->
        <header class="mb-6 text-center bg-gray-700 text-white py-4 shadow rounded">
            <h1 class="text-3xl font-bold">User Credentials Information</h1>
        </header>

        <!-- Navigation menu -->
        <nav class="mb-6 bg-gray-600 rounded shadow">
            <div class="flex items-center py-2 px-4 space-x-4">
                <a href="Administrator.php" class="text-white hover:text-gray-200 font-medium">Administrator Page</a>
                <form action="logout.php" method="POST">
                    <button type="submit" class="text-white hover:text-gray-200 font-medium">Logout</button>
                </form>
            </div>
        </nav>

        <!-- Success/Error Messages -->
        {% if message %}
            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                {{ message }}
            </div>
        {% endif %}
        {% if error %}
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                {{ error }}
            </div>
        {% endif %}

        <!-- Add New User -->
        <div class="bg-white p-6 rounded shadow mb-6">
            <h2 class="text-2xl font-semibold mb-4">Add New User</h2>
            <form method="POST" class="space-y-4">

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" name="first_name" placeholder="First Name" required class="border rounded px-3 py-2 w-full">
                    <input type="text" name="last_name" placeholder="Last Name" required class="border rounded px-3 py-2 w-full">
                    <input type="email" name="user_email" placeholder="Email" required class="border rounded px-3 py-2 w-full">

                    <!-- Password with toggle and warning -->
                    <div class="relative">
                        <input type="password" id="password" name="user_password" placeholder="Password" required class="border rounded px-3 py-2 w-full">
                        <span id="togglePassword" class="absolute right-3 top-2.5 cursor-pointer text-yellow-500">üëÅ</span>
                        <p id="password-warning" class="text-red-600 text-sm mt-1 hidden">
                            Password must be at least 8 characters, include uppercase, lowercase, number, and special character.
                        </p>
                    </div>

                    <select name="user_role" class="border rounded px-3 py-2 w-full">
                        {% for role in roles %}
                            <option value="{{ role }}">{{ role|capitalize }}</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="phone_number" placeholder="Phone Number" class="border rounded px-3 py-2 w-full">
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" name="approved" checked class="rounded">
                        <span>Approved</span>
                    </label>
                </div>

                <button type="submit" name="submitUserRecord" class="bg-gray-700 hover:bg-gray-800 text-white font-semibold px-4 py-2 rounded">Add User</button>
            </form>
        </div>

        <!-- Search Users -->
        <div class="mb-4">
            <form method="GET" class="flex items-center space-x-2">
                <input type="text" name="search" value="{{ app.request.get('search') }}" placeholder="Search by first name, last name, or email" class="border rounded px-3 py-2 w-full">
                <button type="submit" class="bg-gray-700 hover:bg-blue-700 text-white px-4 py-2 rounded">Search</button>
            </form>
        </div>

        <!-- Displaying Existing Users -->
        <div class="bg-white p-6 rounded shadow">
            <h2 class="text-2xl font-semibold mb-4">Existing Users</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">ID</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">First Name</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Last Name</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Email</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Role</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Phone</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Approved</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Date Created</th>
                            <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-gray-100 divide-y divide-gray-200">
                        {% for user in users %}
                        <tr class="hover:bg-gray-200">
                            <form method="POST" class="grid grid-cols-1 md:grid-cols-9 gap-2">
                                <td class="px-2 py-2">{{ user.user_id }}</td>
                                <td class="px-2 py-2"><input type="text" name="first_name" value="{{ user.first_name }}" class="border rounded px-2 py-1 w-full"></td>
                                <td class="px-2 py-2"><input type="text" name="last_name" value="{{ user.last_name }}" class="border rounded px-2 py-1 w-full"></td>
                                <td class="px-2 py-2"><input type="email" name="user_email" value="{{ user.user_email }}" class="border rounded px-2 py-1 w-full"></td>
                                <td class="px-2 py-2">
                                    <select name="user_role" class="border rounded px-2 py-1 w-full">
                                        {% for role in roles %}
                                            <option value="{{ role }}" {% if user.user_role == role %}selected{% endif %}>{{ role|capitalize }}</option>
                                        {% endfor %}
                                    </select>
                                </td>
                                <td class="px-2 py-2"><input type="text" name="phone_number" value="{{ user.phone_number }}" class="border rounded px-2 py-1 w-full"></td>
                                <td class="px-2 py-2 text-center"><input type="checkbox" name="approved" value="1" {% if user.approved %}checked{% endif %} class="rounded"></td>
                                <td class="px-2 py-2">{{ user.date_created }}</td>
                                <td class="px-2 py-2 flex flex-col space-y-1">
                                    <input type="hidden" name="user_id" value="{{ user.user_id }}">
                                    <input type="password" name="user_password" placeholder="New Password" class="border rounded px-2 py-1 w-full">
                                    <button type="submit" name="updateuser" class="bg-gray-700 hover:bg-gray-800 text-white px-2 py-1 rounded">Update</button>
                                    <button type="submit" name="deleteuser" onclick="return confirm('Delete this user?');" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded">Delete</button>
                                </td>
                            </form>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- Include togglePassword.js -->
    <script src="javascripts/togglePassword.js"></script>

</body>
</html>
